#!/usr/bin/env sh

# exit if command fails
set -e
# sane behaviour for cd
unset CDPATH
# set IFS to SP HT LF.
IFS=' 	
'

usage () {
  cat << EOF
usage: `basename "$0"` [OPTIONS]...

Display the public IP-Address.

Options:
  -v    verbose output
  -h    display this help and exit"
EOF
}

verbose=0

while getopts "vh" opt; do
  case "$opt" in
    h)
      usage
      exit 0
      ;;
    v)
      verbose=1
      ;;
    \?)
      usage
      exit 1
      ;;
  esac
done

shift $((OPTIND-1))

if command -v dig >/dev/null 2>&1; then
  [ "$verbose" -eq 1 ] && set -o xtrace
  dig +short @resolver1.opendns.com myip.opendns.com
elif command -v curl >/dev/null 2>&1; then
  [ "$verbose" -eq 1 ] && set -o xtrace
  curl -s "http://checkip.dyndns.org" | grep --color=never -o "[[:digit:].]\+"
elif command -v wget >/dev/null 2>&1; then
  [ "$verbose" -eq 1 ] && set -o xtrace
  wget -q -O- "http://checkip.dyndns.org" | grep --color=never -o "[[:digit:].]\+"
else
  printf "No suitable ommand found.\n\n"
  exit 120
fi

# vim: ft=sh ts=2 sts=2 sw=2 et:
